# Claude Code カスタムコマンド

このプロジェクト用のカスタムスラッシュコマンド集

## 利用可能なコマンド

### `/create-svg` - SVG作成 (重なり防止版)

新しいSVGダイアグラムを、テキストの重なりを防ぎながら作成します。

**使用例:**
```
/create-svg

以下のコンテンツでSVGを作成してください：
- タイトル: "リバースエンジニアリングのプロセス"
- ステップ1-5: 各ステップに説明文
- レイアウト: 横並びフロー図
```

**主な機能:**
- テキスト幅の事前計算
- 最小間隔ルールの適用 (垂直: font_size×1.4, 水平: 10px)
- viewBoxサイズの推奨
- フォントサイズ階層の設定
- 配置計算ガイド
- 作成後の検証チェックリスト

---

### `/fix-svg-overlap` - SVG重なり修正

既存のSVGファイルのテキスト重なり問題を診断・修正します。

**使用例:**
```
/fix-svg-overlap

diagrams/diagram_03_5step_flow.svg の重なりを修正してください。
現在のスコア: 26/100
問題: 垂直18箇所、水平4箇所、oversized2箇所
```

**修正戦略:**
1. **優先度1:** y座標調整のみ（構造変更なし）
2. **優先度2:** フォントサイズ調整
3. **優先度3:** 改行追加
4. **優先度4:** レイアウト再設計

**問題タイプ別の修正方法:**
- **垂直重なり (v):** y座標を調整、間隔を font_size × 1.4 以上に
- **水平重なり (h):** x座標調整、改行、またはフォントサイズ縮小
- **oversized:** 改行、フォントサイズ縮小、またはviewBox拡張

---

### `/check-svg-quality` - SVG品質チェック

すべてのSVGの品質を評価し、問題のあるファイルを特定します。

**使用例:**
```
/check-svg-quality

現在のSVG品質状況を教えてください。
```

**評価項目:**
- SVGテキスト重なり (25%)
- SVGテキスト可読性 (20%)
- オーバーフロー制御 (30%)
- 余白バランス (15%)
- フォント可読性 (5%)
- コンテンツ密度 (5%)

**スコア基準:**
- 🟢 90-100: Excellent (修正不要)
- 🔵 70-89: Good (推奨範囲)
- 🟡 50-69: Fair (修正推奨)
- 🔴 0-49: Poor (修正必須)

---

## 典型的なワークフロー

### 新規SVG作成
```
1. /create-svg
2. コンテンツとレイアウト要件を伝える
3. SVGが生成される
4. /check-svg-quality で検証
5. スコア 80/100 以上なら完了
```

### 既存SVG修正
```
1. /check-svg-quality
2. スコアが低いSVGを特定
3. /fix-svg-overlap
4. 問題のあるSVGファイル名とスコアを伝える
5. 修正が適用される
6. /check-svg-quality で再検証
```

### 一括チェック＆修正
```
1. /check-svg-quality
2. 問題のあるSVGリストを取得
3. スコア順に優先度を決定
4. /fix-svg-overlap を使って1つずつ修正
5. 最後に /check-svg-quality で全体を再確認
```

## クイックリファレンス

### テキスト幅計算式
```python
width = (日本語文字数 × font_size × 1.0 +
         英数字文字数 × font_size × 0.5) × 1.1
```

### 最小間隔ルール
- 垂直: `gap >= max(font_size1, font_size2) × 1.4`
- 水平: `gap >= max(10px, font_size × 0.2)`

### viewBox推奨サイズ
- シンプル (要素≤5): 1000×600
- 標準 (要素6-15): 1200×800
- 複雑 (要素≥16): 1600×1000

### フォントサイズ制約
- 最大: `viewBox幅 × 0.06`
- 最小: `18px` (可読性のため)

### セーフエリア
- 幅: `viewBox幅 × 0.85` (15%マージン)
- 高さ: `viewBox高さ × 0.80` (20%マージン)

## トラブルシューティング

**Q: コマンドが表示されない**
→ Claude Codeを再起動してください

**Q: /create-svg で作成したSVGがスコア 50/100**
→ コンテンツが多すぎる可能性。要素を削減するか viewBox を拡大

**Q: /fix-svg-overlap で修正してもスコアが上がらない**
→ レイアウト全体の再設計が必要。/create-svg で新規作成を検討

**Q: 水平重なりが解消できない**
→ カラム数を減らす（3列→2列）またはフォントサイズを統一

## 参考ファイル

- `slides/evaluate_slide_quality.py` - 品質評価スクリプト
- `slides/analyze_svg_horizontal_overlap.py` - 水平重なり分析
- `slides/slide_quality_scores.json` - 最新の評価結果
