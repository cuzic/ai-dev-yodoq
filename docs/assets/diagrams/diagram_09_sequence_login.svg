<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 540">
  <defs>
    <style>
      .title {
        font-family: 'Noto Sans JP', sans-serif;
        font-size: 31px;
        font-weight: bold;
        fill: #00146E;
      }
      .actor-label {
        font-family: 'Noto Sans JP', sans-serif;
        font-size: 18px;
        font-weight: bold;
        fill: #00146E;
        text-anchor: middle;
      }
      .message-text {
        font-family: 'Noto Sans JP', sans-serif;
        font-size: 15px;
        fill: #333333;
      }
      .step-number {
        font-family: 'Noto Sans JP', sans-serif;
        font-size: 14px;
        font-weight: bold;
        fill: #FFFFFF;
        text-anchor: middle;
      }
      .actor-box {
        fill: #00AFF0;
        stroke: #00146E;
        stroke-width: 2;
        rx: 5;
      }
      .lifeline {
        stroke: #666666;
        stroke-width: 1;
        stroke-dasharray: 5,5;
      }
      .activation {
        fill: #F0F8FF;
        stroke: #00146E;
        stroke-width: 2;
      }
      .arrow {
        stroke: #00146E;
        stroke-width: 2;
        fill: none;
        marker-end: url(#arrowhead);
      }
      .return-arrow {
        stroke: #666666;
        stroke-width: 2;
        fill: none;
        stroke-dasharray: 5,5;
        marker-end: url(#return-arrowhead);
      }
      .number-circle {
        fill: #00AFF0;
        stroke: #00146E;
        stroke-width: 1;
      }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#00146E" />
    </marker>
    <marker id="return-arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666666" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="20" y="35" class="title">シーケンス図：ログインフロー</text>

  <!-- Actors -->
  <rect x="30" y="60" width="100" height="35" class="actor-box"/>
  <text x="80" y="82" class="actor-label">ユーザー</text>

  <rect x="200" y="60" width="110" height="35" class="actor-box"/>
  <text x="255" y="82" class="actor-label">Controller</text>

  <rect x="380" y="60" width="100" height="35" class="actor-box"/>
  <text x="430" y="82" class="actor-label">Service</text>

  <rect x="550" y="60" width="120" height="35" class="actor-box"/>
  <text x="610" y="82" class="actor-label">Database</text>

  <!-- Lifelines -->
  <line x1="80" y1="95" x2="80" y2="500" class="lifeline"/>
  <line x1="255" y1="95" x2="255" y2="500" class="lifeline"/>
  <line x1="430" y1="95" x2="430" y2="500" class="lifeline"/>
  <line x1="610" y1="95" x2="610" y2="500" class="lifeline"/>

  <!-- Step 1: Login request -->
  <circle cx="30" cy="120" r="10" class="number-circle"/>
  <text x="30" y="123" class="step-number">1</text>
  <path d="M 80 120 L 245 120" class="arrow"/>
  <text x="120" y="115" class="message-text">POST /login</text>
  <text x="120" y="135" class="message-text" style="font-size: 13px;">(email, password)</text>

  <!-- Activation bar for Controller -->
  <rect x="250" y="120" width="10" height="320" class="activation"/>

  <!-- Step 2: Call service -->
  <circle cx="30" cy="165" r="10" class="number-circle"/>
  <text x="30" y="168" class="step-number">2</text>
  <path d="M 260 165 L 425 165" class="arrow"/>
  <text x="300" y="160" class="message-text">authenticate()</text>

  <!-- Activation bar for Service -->
  <rect x="425" y="165" width="10" height="240" class="activation"/>

  <!-- Step 3: Query user -->
  <circle cx="30" cy="210" r="10" class="number-circle"/>
  <text x="30" y="213" class="step-number">3</text>
  <path d="M 435 210 L 605 210" class="arrow"/>
  <text x="470" y="205" class="message-text">findByEmail()</text>

  <!-- Step 4: Return user data -->
  <circle cx="30" cy="245" r="10" class="number-circle"/>
  <text x="30" y="248" class="step-number">4</text>
  <path d="M 600 245 L 435 245" class="return-arrow"/>
  <text x="480" y="240" class="message-text">User</text>

  <!-- Step 5: Verify password -->
  <circle cx="30" cy="280" r="10" class="number-circle"/>
  <text x="30" y="283" class="step-number">5</text>
  <rect x="435" y="275" width="120" height="30" style="fill: #F0F8FF; stroke: #00146E; stroke-width: 2;"/>
  <text x="445" y="293" class="message-text">BCrypt.verify()</text>

  <!-- Step 6: Generate JWT -->
  <circle cx="30" cy="325" r="10" class="number-circle"/>
  <text x="30" y="328" class="step-number">6</text>
  <rect x="435" y="320" width="120" height="30" style="fill: #F0F8FF; stroke: #00146E; stroke-width: 2;"/>
  <text x="445" y="338" class="message-text">generateJWT()</text>

  <!-- Step 7: Return token -->
  <circle cx="30" cy="370" r="10" class="number-circle"/>
  <text x="30" y="373" class="step-number">7</text>
  <path d="M 425 370 L 260 370" class="return-arrow"/>
  <text x="310" y="365" class="message-text">JWT token</text>

  <!-- Step 8: Response -->
  <circle cx="30" cy="415" r="10" class="number-circle"/>
  <text x="30" y="418" class="step-number">8</text>
  <path d="M 245 415 L 80 415" class="return-arrow"/>
  <text x="130" y="410" class="message-text">200 OK + token</text>

  <!-- Error handling note -->
  <rect x="30" y="450" width="640" height="50" style="fill: #FFF3CD; stroke: #FF8C00; stroke-width: 2; rx: 5;"/>
  <text x="40" y="470" style="font-family: 'Noto Sans JP', sans-serif; font-size: 15px; fill: #333333; font-weight: bold;">エラー処理:</text>
  <text x="40" y="490" style="font-family: 'Noto Sans JP', sans-serif; font-size: 14px; fill: #333333;">ユーザー不在→401、パスワード不一致→401、5回失敗→アカウントロック</text>
</svg>
